<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initial Setup - CTF Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .setup-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 100%;
        }
        .setup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            text-align: center;
        }
        .setup-body {
            padding: 30px;
        }
        .btn-setup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            font-weight: 600;
        }
        .btn-setup:hover {
            opacity: 0.9;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="setup-card">
            <div class="setup-header">
                <h1 class="mb-2">ðŸš€ Welcome!</h1>
                <p class="mb-0">Let's set up your CTF platform</p>
            </div>
            <div class="setup-body">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <div class="alert alert-info">
                    <strong>First Time Setup</strong><br>
                    Create your administrator account to get started.
                </div>

                <form method="POST" action="{{ url_for('setup.initial_setup') }}">
                    <div class="mb-3">
                        <label for="username" class="form-label">Admin Username <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="username" name="username" 
                               placeholder="admin" required autofocus>
                        <small class="form-text text-muted">This will be your login username</small>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Admin Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="email" name="email" 
                               placeholder="admin@example.com" required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
                        <input type="password" class="form-control" id="password" name="password"
                               placeholder="Min. 6 characters" required>
                    </div>

                    <div class="mb-4">
                        <label for="confirm_password" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" 
                               placeholder="Re-enter password" required>
                    </div>

                    <hr class="my-4">

                    <div class="mb-3">
                        <label for="ctf_name" class="form-label">CTF Name (optional)</label>
                        <input type="text" class="form-control" id="ctf_name" name="ctf_name" 
                               placeholder="My Awesome CTF" value="CTF Platform">
                        <small class="form-text text-muted">You can change this later in settings</small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Challenge Submission Mode</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="submission_mode" id="mode_individual" value="individual" checked>
                            <label class="form-check-label" for="mode_individual">
                                <strong>Individual</strong> - Users can solve challenges without being in a team
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="submission_mode" id="mode_team_required" value="team_required">
                            <label class="form-check-label" for="mode_team_required">
                                <strong>Team Required</strong> - Users must join a team before solving challenges
                            </label>
                        </div>
                        <small class="form-text text-muted">You can override this per-challenge in admin panel</small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Dynamic Scoring Decay Function</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="decay_function" id="decay_logarithmic" value="logarithmic" checked>
                            <label class="form-check-label" for="decay_logarithmic">
                                <strong>Logarithmic</strong> - Smooth, gradual points decrease
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="decay_function" id="decay_parabolic" value="parabolic">
                            <label class="form-check-label" for="decay_parabolic">
                                <strong>Parabolic</strong> - Steeper decrease early, then levels out
                            </label>
                        </div>
                        <small class="form-text text-muted">How challenge points decrease as more teams solve them</small>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-setup btn-lg">
                            Complete Setup
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Client-side password validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirm_password').value;
            
            if (password !== confirm) {
                e.preventDefault();
                alert('Passwords do not match!');
                return false;
            }
            
            if (password.length < 6) {
                e.preventDefault();
                alert('Password must be at least 6 characters long!');
                return false;
            }
        });
    </script>
</body>
</html>
